language: csharp
mono: none
dotnet: 3.1.302
dist: bionic
git:
  submodules: false

env:
  global:
  - DOTNET_NOLOGO=true
  - DOTNET_CLI_TELEMETRY_OPTOUT=true
  - DOTNET_SKIP_FIRST_TIME_EXPERIENCE=true

addons:
  sonarcloud:
    organization: "herve-m"
    token:
      secure: "Oqejs5B8I+9+UxT3wuByOVYsoBDj2Wc3xuDMXrzaFB/fTm/idmlIFpYaFt4j81mO1YHzGzDRgKIptdW+Ozbmjx/aWls579fGoVz75kf5qAHND92zRtKl+fK9Vy0kswMp9QsUGfCcQHt2YY38JaeyNOFP+B2onj15kbhMSukNOOd+K65DiGw9KQ6jd/EAKJdGs3fD6rOy0IQWHDegMOkiQDeJNVWTBSJO6vo5qTpsTd7xp5G9raNuWz0K4FoSUrIHjJhHjByNYKgObGt1FMNZFw1J3VMQAhyTpc2jYrddHXz5Wd1lk2yV8qgWPuN2z+cjiQ20/4EjQ4z3VC7W0CpMz7TPEdFWtWhpFIt37Xo37EC3lFlk7jXA7ph9n1h2G2nR4RVpzA2gpNTRzJuOYzPtTNOunHQPQ8zhc6xjofErpWqfv2JYob2NxftZws/dGy0ZLnrnPQO7Tsphc3S5bUPrZTyUIiL98z2BivQPbJOLzeONxaglkIdDzkslKGA/jlfuJGA9JlNzGi+Kowm6Cq6KF90PQeAfzjcnQ6H/TsXKyKlVrfkmMfNXRRA5heraI9+2PXBp6GyYWruCnW2PY9EiLU4LHEVVd1rgUEgmMh38lxRigyxoFt3bRyriGKnUIzTsIGTc312XUmrPNe0o7LMzk9jL90LIVP424mFOfFeezhk="

branches:
  only:
  - master
  - develop

stages:
- name: build
- name: test
- name: quality-check
- name: pack

install: 
  - dotnet restore UCWA.Meeting.sln

jobs:
  include:
  - stage: build
    script: dotnet build UCWA.Meeting.sln -c Release
  - stage: test
    script: dotnet test UCWA.Meeting.sln -c Release
  - stage: quality-check
    script:
      - sonar-scanner
  - stage: pack
    script:
    - dotnet pack src\UCWA.Meeting.Abstractions\UCWA.Meeting.Abstractions.csproj -c Release
    - dotnet pack src\UCWA.Meeting.Client\UCWA.Meeting.Client.csproj --include-symbols -c Release

notifications:
  email:
    on_success: never
    on_failure: change
